(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{9982:function(e,t,r){Promise.resolve().then(r.bind(r,5060))},5060:function(e,t,r){"use strict";r.d(t,{QueryScore:function(){return W}});var n=r(7437),i=r(2641),s=r(2265),a=r(2828);class o{interpolate(e){var t,r,n,i,s,a,o,l,c,h;for(a=h=this.x.length-2;(h<=0?a<=0:a>=0)&&!(this.x[a]<=e);h<=0?a+=1:a-=1);return t=this.x[a+1]-this.x[a],l=Math.pow(o=(e-this.x[a])/t,2),r=2*(c=Math.pow(o,3))-3*l+1,i=c-2*l+o,n=-2*c+3*l,s=c-l,r*this.y[a]+i*t*this.m[a]+n*this.y[a+1]+s*t*this.m[a+1]}constructor(e,t){var r,n,i,s,a,o,l,c,h,u,d,m,p,x,f,g,v;for(a=0,l=e.length,i=[],o=[],r=[],n=[],s=[],c=[],x=l-1;0<=x?a<x:a>x;0<=x?a+=1:a-=1)i[a]=(t[a+1]-t[a])/(e[a+1]-e[a]),a>0&&(o[a]=(i[a-1]+i[a])/2);for(a=0,o[0]=i[0],o[l-1]=i[l-2],h=[],f=l-1;0<=f?a<f:a>f;0<=f?a+=1:a-=1)0===i[a]&&h.push(a);for(u=0,m=h.length;u<m;u++)o[a=h[u]]=o[a+1]=0;for(a=0,g=l-1;0<=g?a<g:a>g;0<=g?a+=1:a-=1)r[a]=o[a]/i[a],n[a]=o[a+1]/i[a],s[a]=Math.pow(r[a],2)+Math.pow(n[a],2),c[a]=3/Math.sqrt(s[a]);for(a=0,h=[],v=l-1;0<=v?a<v:a>v;0<=v?a+=1:a-=1)s[a]>9&&h.push(a);for(d=0,p=h.length;d<p;d++)o[a=h[d]]=c[a]*r[a]*i[a],o[a+1]=c[a]*n[a]*i[a];this.x=e.slice(0,l),this.y=t.slice(0,l),this.m=o}}function l(){let{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}var c=r(4267);let h="osmd";class u extends a.OpenSheetMusicDisplay{setup(){this.rules.FingeringPosition=1,this.rules.FingeringOffsetY=1,this.rules.FingeringPositionFromXML=!1}}let d=async(e,t,r,n)=>{let i=new u(h,{drawCredits:!1,drawPartNames:!1,measureNumberInterval:4});return i.setup(),await i.load(e),i.setCustomPageFormat(t,r),i.Zoom=n,i.render(),i},m=(e,t,r)=>[...Array(r)].map((n,i)=>e+(t-e)*i/r),p=(e,t)=>{let r=e.GraphicSheet.MeasureList,n=r.map(e=>{var t;return null===(t=e[0])||void 0===t?void 0:t.stave.x}),i=Object.entries(t).map(e=>[parseFloat(e[0]),e[1]]);if(i.sort((e,t)=>e[0]-t[0]),i=[[0,0]].concat(i),!c.r.isHorizontalMode()){let e=r.map(e=>{var t;return null===(t=e[0])||void 0===t?void 0:t.stave.y}),t=e[0];e=e.map(e=>e-t);let i=0,s=[[0,0]],a=[];e.forEach((e,t)=>{if(!isNaN(e)){if(e!=i){let e=s[s.length-1],r=m(e[1],i,t-e[0]);a=a.concat(r),s.push([t,i])}i=e}});let o=s[s.length-1],l=e.length-1;if(o[0]!=l){s.push([l,i]);let e=m(o[1],i,l-o[0]);(a=a.concat(e)).push(i)}n=a}let s=i.length,[a,l]=i[0],h=[],u=[];for(let e=0;e<s-1;++e){let[t,r]=i[e+1];if(void 0!==n[r-1]){for(let e=l;e<r;++e){let i=n[e-1];if(void 0!==i){let n=a+(t-a)*(e-l)/(r-l);h.push(n),u.push(i)}}a=t,l=r}}h.push(a),u.push(n[l-1]),[1,2].forEach(e=>{h.push(a+5*e),u.push(n[l-1])});let d=c.r.isHorizontalMode()?.3:0,p=new o(h,u);return(e,t)=>{let r=d*window.innerWidth;return Math.max(0,p.interpolate(e)*t-r)}},x=e=>{let[t,r]=(0,s.useState)({x:0,y:0}),[i,a]=(0,s.useState)(null),{height:o}=function(){let[e,t]=(0,s.useState)(l());return(0,s.useEffect)(()=>{function e(){t(l())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}(),u=c.r.getZoom(),m=Math.max(150,.2*o),x=Math.max(Math.min(1,m/260),.5)*u,f=m*x,g=c.r.isHorizontalMode()?4e4*f:window.innerWidth,{getTime:v,measureMap:y,xml:w}=e;(0,s.useEffect)(()=>((async()=>{let e=c.r.isHorizontalMode()?m*u:1e5;a({ip:p(await d(w,g,e,x),y)})})(),()=>{a(null)}),[w,y,m,u,x,g]),(0,s.useEffect)(()=>{if(null!==i){let e=i.ip,t=setInterval(async()=>{let t=e(await v(),x);r(c.r.isHorizontalMode()?{x:t,y:0}:{x:0,y:t})},20);return()=>{clearInterval(t)}}},[v,i,x]);let j=c.r.isHorizontalMode()?m*u:800;return(0,n.jsx)("div",{style:{overflow:"hidden"},children:(0,n.jsx)("div",{id:h,style:{height:"".concat(j+t.y,"px"),width:"".concat(g,"px"),marginLeft:"-".concat(t.x,"px"),marginTop:"-".concat(t.y,"px")}})})};var f=r(5259),g=r(5061),v=r(8138);let y=[1,0,-1],w=async e=>(await fetch(e)).text(),j=(e,t,r,n)=>{let s=(0,i.s1)(e,t);s.childNodes.forEach(e=>{e.nodeName===r&&e.id!==n&&s.removeChild(e)})},I=e=>{let t=e.cloneNode(!0);return t.xmlStandalone=e.xmlStandalone,t},M=e=>{let t=e.parts[e.currPartIdx].id,r=I(e.origXml);j(r,"part-list","score-part",t),j(r,"score-partwise","part",t);let n=c.r.getFingering();return(0,i.p4)(r,e.pitch,e.octave,n),r},E=e=>{let t=(0,i.s1)(e,"score-partwise"),r=[],n=t.getElementsByTagName("score-part");for(let e=0;e<n.length;++e)r.push({id:n[e].id,name:n[e].getElementsByTagName("part-name")[0].textContent});return r},N=()=>c.r.getInstrumentKey(),P=e=>{let{scoreInfo:t,player:r}=e,a="/mxl/".concat(t.fileName,".musicxml"),o="https://musescore.com/user/83726533/scores/".concat(t.source),{t:l}=(0,v.Z)(),[c,h]=(0,s.useState)(null);if((0,s.useEffect)(()=>{(async()=>{let e=await w(a),t=(0,i.ON)(e),r={xml:t,parts:E(t),currPartIdx:0,origXml:t,pitch:N(),octave:0};h({...r,xml:M(r)})})()},[a]),null!==c){let e=c.pitch,s=c.currPartIdx,u=c.octave,d=(t,r,n)=>{if(t===s&&r===e&&n===u)return;let i={...c,currPartIdx:t,pitch:r,octave:n},a=M(i);h({...i,xml:a,currPartIdx:t})},m=e=>e>0?"+".concat(e):"".concat(e),p=l("octave"),v=0===u?p:"".concat(p,": ").concat(m(u)),w=y.map(t=>({name:m(t),onClick:()=>d(s,e,t),key:m(t)})),j=(0,n.jsx)(f.H,{options:w,children:v}),I=e=>d(s,e,u),E=i.xj.map((e,t)=>({name:e,onClick:()=>I(e),key:e})),N=l("instrumentKeyShort"),P=(0,n.jsx)(f.H,{options:E,children:"".concat(N,": ").concat(e)}),S=(0,n.jsxs)("div",{style:g.Pp,children:[P,j]}),b=(0,n.jsx)(x,{xml:c.xml,measureMap:t.measureMap,getTime:r.getTime},a),k=(0,n.jsx)("div",{style:{width:i.g1.width,maxWidth:i.g1.maxWidth,margin:"auto"},children:(0,n.jsxs)("div",{style:{...g.yR,...g.W9},children:[(0,n.jsxs)("h4",{children:[l("viewSheetsOn"),(0,n.jsx)("br",{}),(0,n.jsx)("a",{href:o,target:"_blank",children:"MuseScore.com"})]}),S]})}),C=(0,n.jsx)("div",{style:{width:i.g1.width,maxWidth:i.g1.maxWidth,margin:"auto"},children:(0,n.jsxs)("div",{style:{...g.yR,...g.W9},children:[(0,n.jsx)("h3",{children:t.name}),(0,n.jsx)("h3",{children:"-"}),(0,n.jsx)("h3",{children:t.artist})]})});return(0,n.jsxs)(n.Fragment,{children:[C,r.comp,k,b]})}return(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{style:g.yR,children:"Loading..."})})};var S=r(5107);let b=e=>{let t=(0,s.useRef)(),r=(0,s.useCallback)(async()=>await t.current.getInternalPlayer().getCurrentTime(),[t]);return{comp:(0,n.jsx)(k,{playerRef:t,videoId:e}),getTime:r}},k=e=>{let{videoId:t,playerRef:r}=e,a={...i.g1,playerVars:{autoplay:1}},o=s.createElement(S.Z,{videoId:t,opts:a,ref:r,onReady:()=>console.log("I'm ready, loaded ".concat(t,"!"))});return(0,n.jsx)("div",{style:{...i.g1,margin:"auto"},children:(0,n.jsx)("div",{style:g.yR,children:o})})};var C=r(9376),F=r(9622);let H=e=>{let t=i.f$.filter(t=>t.videoId===e.scoreId);if(0===t.length)return(0,n.jsxs)("h3",{children:["YouTube score with ID ",(0,n.jsx)("b",{children:e.scoreId})," not found :("]});let r=t[0];return(0,n.jsx)(T,{scoreInfo:r})},T=e=>{let{scoreInfo:t}=e,r=b(t.videoId);return(0,n.jsx)(P,{scoreInfo:t,player:r})},W=()=>{let e=(0,C.useSearchParams)().get("scoreId");return void 0===e||"string"!=typeof e?(0,n.jsx)(F.To404,{}):(0,n.jsx)(H,{scoreId:e})}},9622:function(e,t,r){"use strict";r.d(t,{To404:function(){return o}});var n=r(7437),i=r(8138),s=r(9376),a=r(2265);let o=()=>{let{getLink:e}=(0,i.Z)(),t=(0,s.useRouter)();return(0,a.useEffect)(()=>{t.push(e("/404"))}),(0,n.jsx)(n.Fragment,{})}}},function(e){e.O(0,[170,822,648,609,107,209,971,117,744],function(){return e(e.s=9982)}),_N_E=e.O()}]);